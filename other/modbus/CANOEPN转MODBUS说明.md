# CANOEPN转MODBUS说明

## 目录

[TOC]



## 1.功能

## 1.1节点查看与设置

### 1.1.1设置节点ID

对**寄存器**地址0x01写入节点ID进行节点设置。可以进行对该节点的查看与设置。

|寄存器种类|读取地址|数据类型|参数范围|默认值|备注|
| --------------- | -------------------------- | --------------- | -------------------------- | --------------- | --------------- |
|保持寄存器|0X01| uint16   | 1~节点数[1.1.2查看节点数](#1.1.2查看节点数) | 1      |设置需操作的节点ID|

### 1.1.2查看节点数

读取**输入寄存器**地址0X01查看总线节点数量，节点数量为本机节点(主节点)+从机节点数。

| 寄存器种类 | 读取地址 | 数据类型 | 参数范围 | 默认值 | 备注             |
| ---------- | -------- | -------- | -------- | ------ | ---------------- |
| 输入寄存器 | 0X01     | uint16   | 1~128    | 1      | 查看总线节点数量 |

### 1.1.3查看节点当前NMT状态

NMT状态分为如下几个状态,一般节点进入Operational状态即正常，其他状态异常。

```c
/* The nodes states 
 * -----------------
 * values are choosen so, that they can be sent directly
 * for heartbeat messages...
 * Must be coded on 7 bits only
 * */
/* Should not be modified */
enum enum_nodeState {
  Initialisation  = 0x00, //节点上电
  Disconnected    = 0x01, //节点丢失
  Connecting      = 0x02, //节点连接
  Preparing       = 0x02, //节点准备阶段
  Stopped         = 0x04, //节点停止
  Operational     = 0x05, //节点可操作状态
  Pre_operational = 0x7F, //节点预操作状态
  Unknown_state   = 0x0F  //节点未知状态
};
```

读取**输入寄存器**地址0X02来获取设置节点的NMT状态。默认查看主节点(节点ID = 0x01)状态，查看其他节点状态需设置节点ID[1.1.1设置节点ID](#1.1.1设置节点ID)

| 寄存器种类 | 读取地址 | 数据类型 | 参数范围       | 默认值 | 备注         |
| ---------- | -------- | -------- | -------------- | ------ | ------------ |
| 输入寄存器 | 0X02     | uint16   | enum_nodeState | 0x0F   | 查看节点状态 |

## 1.2.1电机使能与禁用

对**线圈**地址0X01写入True使能电机控制，写入False禁用电机。

对**寄存器**地址0x01写入参数进行模式设置。

参数范围如下:

| 模式            | **寄存器**地址0x01写入参数 | 备注            |
| --------------- | -------------------------- | --------------- |
| PP,位置规划模式 | 0X01                       | 无附加参数      |
| IP,插补位置模式 | 0X02                       | 不可使用        |
| HM,原点复归模式 | 0X04                       | 有附加参数[^1]: |
| PV,速度规划模式 | 0X08                       | 无附加参数      |



## 附录

### 保持寄存器列表

| 寄存器种类 | 读取地址 | 数据类型 | 参数范围 | 默认值 | 备注             |
| ---- | ---- | ---- | ---- | ---- | ---- |
| 保持寄存器 | 0X01 | uint16 |  | 1~节点数[1.1.2查看节点数](#1.1.2查看节点数) | 设置需操作的节点ID |
|      |      |      |      |      |      |
|      |      |      |      |      |      |
|      |      |      |      |      |      |
|      |      |      |      |      |      |
|      |      |      |      |      |      |
|      |      |      |      |      |      |
|      |      |      |      |      |      |
|      |      |      |      |      |      |

### 输入寄存器列表

| 寄存器种类 | 读取地址 | 数据类型 | 参数范围       | 默认值 | 备注             |
| ---------- | -------- | -------- | -------------- | ------ | ---------------- |
| 输入寄存器 | 0X01     | uint16   | 1~65535        | 1      | 查看总线节点数量 |
| 输入寄存器 | 0X02     | uint16   | enum_nodeState | 0x0F   | 查看节点状态     |
|            |          |          |                |        |                  |
|            |          |          |                |        |                  |
|            |          |          |                |        |                  |
|            |          |          |                |        |                  |
|            |          |          |                |        |                  |
|            |          |          |                |        |                  |

[^1]: 偏移值,回原高速，过零低速，回原方式